!function(t,e){"object"==typeof exports?module.exports=e($):t.AutoSearch=e(window.Zepto||window.jQuery||$)}(this,function(r){function t(){}return t.prototype={init:function(t){var e=Math.random().toString().replace(".","");this.id="autosearch_"+e,this.settings=r.extend({mutil:!1,autoHide:!0,isdel:!1},t),this.input=r(this.settings.input),this.min=this.settings.min||1,this.data=this.settings.data,this.valueObj=r(this.settings.valueObj||this.settings.input),this.valueName=this.settings.valueName||"name",this.target=r(this.settings.target||this.settings.input),this.filterColumn=this.settings.filterColumn||["name"],this.column=this.settings.column||["name"],this.timer=null,this.content=null,this.mutilValueArr=[],this.mutilTextArr=[],this.createContent(),this.bindEvent()},bindEvent:function(){var o=this;this.target.click(function(){return o.settings.autoShow&&o.search(),!1}),this.input.on("focus",function(){var t=r(this);o.timer&&clearInterval(o.timer),o.timer=setInterval(function(){t.data("old")!=t.val()&&(o.search(),t.data("old",t.val()))},25),o.settings.focusCallback&&o.settings.focusCallback.call(o,o.input)}).on("keyup",function(t){var e=r(this);e.data("old")!=e.val()&&13!=t.keyCode&&(o.search(),e.data("old",e.val()))}).on("blur",function(){if(o.settings.autoHide){o.timer&&clearInterval(o.timer);var t=r(this);setTimeout(function(){o.hide(),t.attr("data-text")==t.val()||o.settings.mutil||(o.input.val(""),o.settings.resetCallback&&o.settings.resetCallback.call(o,o.input))},500)}o.settings.blurCallback&&o.settings.blurCallback.call(o,o.input)}).on("keyup",function(t){switch(t.preventDefault(),t.stopPropagation(),t.keyCode){case 40:var e=r(".item.current",o.content).index();e++,e=Math.min(r(".item",o.content).size()-1,e);var i=r(".item.current",o.content);if(r(".item",o.content).removeClass("current").eq(e).addClass("current"),i.size()){var n=r(".item.current",o.content).position(),s=i.outerHeight();if(n.top+s>r(o.content).height()){var a=r(o.content).scrollTop();a+=s,r(o.content).scrollTop(a)}}break;case 38:e=r(".item.current",o.content).index();if(e--,e=Math.max(0,e),r(".item",o.content).removeClass("current").eq(e).addClass("current"),(i=r(".item.current",o.content)).size()){n=r(".item.current",o.content).position(),s=i.outerHeight(),a=r(o.content).scrollTop();n.top<=0&&(a-=s,r(o.content).scrollTop(Math.max(a,0)))}break;case 13:r(".item.current",o.content).trigger("click"),setTimeout(function(){o.hide()},50),o.settings.enterCallback&&o.settings.enterCallback.call(o,this)}}).on("keydown",function(t){13==t.keyCode&&t.preventDefault()}),this.content.on("click",".item",function(){var t=r(this).data("data"),e=r("span",this).text();1==o.settings.mutil?(o.mutilTextArr.push(e),o.mutilValueArr.push(t[o.valueName]),o.input.val(o.mutilTextArr.join(",")+","),o.valueObj.val(o.mutilValueArr.join(",")+","),o.input.attr("data-value",o.input.attr("data-value")),o.input.attr("data-text",o.mutilTextArr.join(",")+",")):(o.input.val(e),o.valueObj.val(t[o.valueName]),o.input.attr("data-value",t[o.valueName]),o.settings.valueObj?o.input.attr("data-text",e):o.input.attr("data-text",t[o.valueName])),o.settings.callback&&o.settings.callback.call(o,t),o.hide()}).on("mouseover",".item",function(){r(this).addClass("current").siblings().removeClass("current")}),r(document).click(function(){o.hide()}),this.content.on("click",".ats_del",function(){var t=r(this).closest(".item");return o.settings.delCallback&&o.settings.delCallback.call(o,t),t.remove(),!1})},createContent:function(){0==r("#"+this.id).size()&&(this.content=r('<div id="'+this.id+'" class="ui-autosearch-content"/>'),this.content.hide(),r("body").append(this.content))},show:function(){var t=this;t.content.show(),t.content.css({position:"absolute",zIndex:t.settings.zIndex||999,width:t.input.outerWidth()}),t.setPostion(),t.postimer=setInterval(function(){t.setPostion()},20),t.settings.showCallback&&t.settings.showCallback.call(t,t.input,t.content)},hide:function(){this.postimer&&clearInterval(this.postimer),this.content.hide()},search:function(){var t=this;if(t.input.val().split(",").pop().length>=t.min||t.settings.autoShow)if("function"==typeof t.data)t.getData();else{var e=t.filter(t.data);t.format(e),t.show()}else t.hide()},getData:function(){var e=this;this.settings.data(function(t){e.format(t),e.show()})},format:function(t){if(this.content.html(""),t)for(var e=0,i=t.length;e<i;e++){var n=t[e],s=r();if(this.settings.format)s=r(this.settings.format.call(this,n));else{for(var a="",o=0,l=this.column.length;o<l;o++)a+='<span class="'+this.column[o]+'">'+n[this.column[o]]+"</span>";s=this.settings.isdel?r('<div class="item">'+a+'<i class="ats_del">âœ–</i></div>'):r('<div class="item">'+a+"</div>")}s.data("data",n),this.content.append(s)}},filter:function(t){for(var e=this.input.val().split(",").pop(),i=[],n=0,s=t.length;n<s;n++)for(var a=t[n],o=0,l=this.filterColumn.length;o<l;o++){-1!=a[this.filterColumn[o]].toString().indexOf(e)&&i.push(a)}return i},setPostion:function(){var t=this,e=t.input.offset();t.content.css({top:e.top+t.input.outerHeight(),left:e.left})}},t});