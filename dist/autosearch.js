!function(t,n){"function"==typeof define&&define.amd?define(["$"],n):"object"==typeof exports?module.exports=n():t.AutoSearch=n(window.Zepto||window.jQuery||$)}(this,function(t){function n(){}return n.prototype={init:function(n){var e=Math.random().toString().replace(".","");this.id="autosearch_"+e,this.settings=n||{},this.input=t(this.settings.input),this.min=this.settings.min||1,this.data=this.settings.data,this.valueObj=t(this.settings.valueObj||this.settings.input),this.valueName=this.settings.valueName||"name",this.target=t(this.settings.target||this.settings.input),this.filterColumn=this.settings.filterColumn||["name"],this.column=this.settings.column||["name"],this.timer=null,this.content=null,this.createContent(),this.bindEvent()},bindEvent:function(){var n=this;this.target.click(function(){return n.settings.autoShow&&n.search(),!1}),this.input.on("focus",function(){var e=t(this);n.timer&&clearInterval(n.timer),n.timer=setInterval(function(){e.data("old")!=e.val()&&(n.search(),e.data("old",e.val()))},25),n.settings.focusCallback&&n.settings.focusCallback.call(n,n.input)}).on("keyup",function(e){var i=t(this);i.data("old")!=i.val()&&(n.search(),i.data("old",i.val()))}).on("blur",function(){n.timer&&clearInterval(n.timer),setTimeout(function(){n.hide()},500),n.settings.blurCallback&&n.settings.blurCallback.call(n,n.input)}).on("keyup",function(e){switch(e.keyCode){case 40:var i=t(".item.current",n.content).index();i++,i=Math.min(t(".item",n.content).size()-1,i);var s=t(".item.current",n.content);if(t(".item",n.content).removeClass("current").eq(i).addClass("current"),s.size()){var o=t(".item.current",n.content).position(),a=s.outerHeight();if(o.top+a>t(n.content).height()){var c=t(n.content).scrollTop();c+=a,t(n.content).scrollTop(c)}}break;case 38:var i=t(".item.current",n.content).index();i--,i=Math.max(0,i),t(".item",n.content).removeClass("current").eq(i).addClass("current");var s=t(".item.current",n.content);if(s.size()){var o=t(".item.current",n.content).position(),a=s.outerHeight();console.log(o,a,t(n.content).height());var c=t(n.content).scrollTop();o.top<=0&&(c-=a,t(n.content).scrollTop(Math.max(c,0)))}break;case 13:t(".item.current",n.content).trigger("click"),setTimeout(function(){n.hide()},50)}}),this.content.on("click",".item",function(){var e=t(this).data("data"),i=t(this).text();1==n.settings.mutil?(n.input.val(n.input.val()+i+","),n.valueObj.val(n.valueObj.val()+e[n.valueName]+",")):(n.input.val(i),n.valueObj.val(e[n.valueName])),n.settings.callback&&n.settings.callback.call(n,e),n.hide()}).on("mouseover",".item",function(){t(this).addClass("current").siblings().removeClass("current")}),t(document).click(function(){n.hide()})},createContent:function(){0==t("#"+this.id).size()&&(this.content=t('<div id="'+this.id+'" class="ui-autosearch-content"/>'),this.content.hide(),t("body").append(this.content))},show:function(){var t=this;t.content.show(),t.content.css({position:"absolute",zIndex:t.settings.zIndex||999,width:t.input.outerWidth()}),t.setPostion(),t.postimer=setInterval(function(){t.setPostion()},20),t.settings.showCallback&&t.settings.showCallback.call(t,t.input,t.content)},hide:function(){this.postimer&&clearInterval(this.postimer),this.content.hide()},search:function(){var t=this,n=t.input.val().split(",").pop();if(n.length>=t.min||t.settings.autoShow)if("function"==typeof t.data)t.getData();else{var e=t.filter(t.data);t.format(e),t.show()}else t.hide()},getData:function(){var t=this;this.settings.data(function(n){t.format(n),t.show()})},format:function(n){this.content.html("");for(var e=0,i=n.length;i>e;e++){var s=n[e],o=t();if(this.settings.format)o=t(this.settings.format.call(this,s));else{for(var a="",c=0,r=this.column.length;r>c;c++)a+='<span class="'+this.column[c]+'">'+s[this.column[c]]+"</span>";o=t('<div class="item">'+a+"</div>")}o.data("data",s),this.content.append(o)}},filter:function(t){for(var n=this,e=n.input.val().split(",").pop(),i=[],s=0,o=t.length;o>s;s++)for(var a=t[s],c=0,r=this.filterColumn.length;r>c;c++){var l=a[this.filterColumn[c]];-1!=l.toString().indexOf(e)&&i.push(a)}return i},setPostion:function(){var t=this,n=t.input.offset();t.content.css({top:n.top+t.input.outerHeight(),left:n.left})}},n});